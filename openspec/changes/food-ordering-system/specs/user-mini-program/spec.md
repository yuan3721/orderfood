## ADDED Requirements

### Requirement: 微信授权登录
用户 SHALL 能够使用微信授权登录小程序，系统自动获取用户昵称和头像。

#### Scenario: 首次登录授权
- **WHEN** 用户首次打开小程序并点击登录
- **THEN** 系统展示微信授权弹窗，用户确认后完成登录

#### Scenario: 已登录用户再次打开
- **WHEN** 已登录用户再次打开小程序
- **THEN** 系统自动识别用户身份，无需重复授权

---

### Requirement: 浏览今日菜单
用户 SHALL 能够在首页查看当日可点的菜品列表，包含菜名、图片、价格、剩余库存。

#### Scenario: 查看今日菜单
- **WHEN** 用户进入首页
- **THEN** 系统展示今日所有可点菜品，每个菜品显示图片、名称、价格、剩余数量

#### Scenario: 菜品售罄显示
- **WHEN** 某菜品库存为 0
- **THEN** 该菜品显示"已售罄"标识，无法选择

---

### Requirement: 截止时间倒计时
用户 SHALL 在首页看到点餐截止时间的倒计时提醒。

#### Scenario: 倒计时显示
- **WHEN** 用户在首页且当前时间在截止时间之前
- **THEN** 页面顶部显示"距离截止还有 XX:XX:XX"倒计时

#### Scenario: 截止后提示
- **WHEN** 当前时间已超过截止时间
- **THEN** 页面显示"今日点餐已截止"，下单按钮禁用

---

### Requirement: 选择菜品加入购物车
用户 SHALL 能够选择菜品并指定数量，添加到购物车。

#### Scenario: 添加菜品到购物车
- **WHEN** 用户点击菜品的"+"按钮
- **THEN** 该菜品添加到购物车，数量为 1

#### Scenario: 修改购物车中菜品数量
- **WHEN** 用户在购物车修改某菜品数量
- **THEN** 系统更新数量，并重新计算总价

#### Scenario: 超出库存限制
- **WHEN** 用户选择的数量超过剩余库存
- **THEN** 系统提示"库存不足"，数量自动调整为最大可购买数

---

### Requirement: 提交订单
用户 SHALL 能够提交购物车中的菜品，生成订单。

#### Scenario: 成功提交订单
- **WHEN** 用户在截止时间前点击"提交订单"
- **THEN** 系统创建订单，扣减库存，跳转到支付页面

#### Scenario: 超时提交失败
- **WHEN** 用户在截止时间后点击"提交订单"
- **THEN** 系统提示"点餐已截止，无法下单"

#### Scenario: 库存不足提交失败
- **WHEN** 提交时某菜品库存已被其他用户抢完
- **THEN** 系统提示"部分菜品库存不足"，返回购物车修改

---

### Requirement: 在线支付
用户 SHALL 能够使用微信支付完成订单支付。

#### Scenario: 微信支付成功
- **WHEN** 用户选择微信支付并完成付款
- **THEN** 订单状态更新为"已支付"，显示支付成功页面

#### Scenario: 支付取消
- **WHEN** 用户取消支付
- **THEN** 订单保持"待支付"状态，用户可稍后在订单页继续支付

#### Scenario: 支付超时
- **WHEN** 订单超过 30 分钟未支付
- **THEN** 订单自动取消，库存恢复

---

### Requirement: 查看历史订单
用户 SHALL 能够查看自己的所有历史订单记录。

#### Scenario: 查看订单列表
- **WHEN** 用户进入"我的订单"页面
- **THEN** 系统展示所有历史订单，按时间倒序排列，显示订单状态

#### Scenario: 查看订单详情
- **WHEN** 用户点击某个订单
- **THEN** 系统展示订单详情，包括菜品列表、数量、总价、下单时间、支付状态

---

### Requirement: 用户设置
用户 SHALL 能够修改个人信息和通知偏好。

#### Scenario: 修改昵称
- **WHEN** 用户在设置页修改昵称并保存
- **THEN** 系统更新用户昵称

#### Scenario: 开关订阅消息
- **WHEN** 用户开启/关闭订阅消息
- **THEN** 系统记录用户偏好，影响后续消息推送
